// SCHEMA EXPANDIDO COM SUPORTE COMPLETO AO PORTUGUÊS
// ===================================================
// Adicionando campos PT faltantes + DrugBank + Formatos Open Data
// Seguindo o modelo Five Star Open Data (HTML/RDFa → RDF/XML → RDF → RDF+Links → Linked Data)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// =====================================================================================
// 1. NOMENCLATURA ORPHANET (COM TRADUÇÃO COMPLETA)
// =====================================================================================

model OrphaDisease {
  // Identificação Orphanet
  id                    String    @id @default(uuid())
  orphaNumber           String    @unique @map("orpha_number")       
  orphaCode             String    @unique @map("orpha_code")         
  
  // Nomes multilíngues ✅ JÁ TEM
  preferredNameEn       String    @map("preferred_name_en")
  preferredNamePt       String?   @map("preferred_name_pt")
  synonymsEn            String?   
  synonymsPt            String?   
  
  // Definições multilíngues (NOVO)
  definitionEn          String?   @map("definition_en")
  definitionPt          String?   @map("definition_pt")
  
  // Classificação hierárquica
  parentId              String?   @map("parent_id")
  parent                OrphaDisease? @relation("DiseaseHierarchy", fields: [parentId], references: [id])
  children              OrphaDisease[] @relation("DiseaseHierarchy")
  
  // Tipo de entidade
  entityType            String    @map("entity_type")               
  classificationLevel   Int?      @map("classification_level")     
  
  // Status e datas
  dateCreated           String?   @map("date_created")
  dateModified          String?   @map("date_modified")
  expertLink            String?   @map("expert_link")
  isActiveDisease       Boolean   @default(true) @map("is_active_disease")
  isObsolete            Boolean   @default(false) @map("is_obsolete")
  
  // Open Data - Identificadores únicos para exportação
  uriRdf                String?   @map("uri_rdf")                   // URI RDF
  jsonldId              String?   @map("jsonld_id")                 // JSON-LD @id
  csvId                 String?   @map("csv_id")                    // ID para CSV
  
  // Metadata
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  
  // Relacionamentos
  linearisations        OrphaLinearisation[]
  externalMappings      OrphaExternalMapping[]
  clinicalSigns         OrphaClinicalSign[]
  phenotypes            OrphaPhenotype[]
  genes                 OrphaGeneAssociation[]
  naturalHistory        OrphaNaturalHistory[]
  epidemiology          OrphaEpidemiology[]
  epidemiologyCPLP      OrphaCPLPEpidemiology[]
  classifications       OrphaMedicalClassification[]
  textualInformation    OrphaTextualInformation[]
  hpoPhenotypeAssociations HPOPhenotypeAssociation[]
  drugAssociations      DrugDiseaseAssociation[]
  
  @@map("orpha_diseases")
}

// =====================================================================================
// 2. LINEARIZAÇÃO ORPHANET ✅ JÁ TEM CAMPOS PT
// =====================================================================================

model OrphaLinearisation {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  linearisationId       String        @map("linearisation_id")
  linearisationCode     String        @map("linearisation_code")
  
  parentLinearisationId String?       @map("parent_linearisation_id")
  parent                OrphaLinearisation? @relation("LinearisationHierarchy", fields: [parentLinearisationId], references: [id])
  children              OrphaLinearisation[] @relation("LinearisationHierarchy")
  
  preferredNameEn       String        @map("preferred_name_en")
  preferredNamePt       String?       @map("preferred_name_pt")  // ✅ JÁ TEM
  classificationLevel   Int           @map("classification_level")
  classificationType    String        @map("classification_type")
  
  @@map("orpha_linearisations")
}

// =====================================================================================
// 3. MAPEAMENTOS EXTERNOS (PRECISA CAMPOS PT)
// =====================================================================================

model OrphaExternalMapping {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  sourceSystem          String        @map("source_system")          
  sourceSystemVersion   String?       @map("source_system_version")
  
  sourceCode            String        @map("source_code")
  sourceName            String        @map("source_name")
  sourceNamePt          String?       @map("source_name_pt")          // ❌ NOVO - PRECISA
  
  mappingType           String        @map("mapping_type")           
  mappingFlag           String?       @map("mapping_flag")           
  mappingApprovalStatus String?       @map("mapping_approval_status")
  
  validationStatus      String?       @map("validation_status")
  lastUpdated           String?       @map("last_updated")
  
  @@map("orpha_external_mappings")
}

// =====================================================================================
// 4. CLASSIFICAÇÕES MÉDICAS (PRECISA CAMPOS PT)
// =====================================================================================

model OrphaMedicalClassification {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  medicalSpecialty      String        @map("medical_specialty")      
  medicalSpecialtyPt    String?       @map("medical_specialty_pt")   // ❌ NOVO - PRECISA
  specialtyCode         String?       @map("specialty_code")
  
  classificationName    String        @map("classification_name")
  classificationNamePt  String?       @map("classification_name_pt") // ❌ NOVO - PRECISA
  classificationLevel   Int?          @map("classification_level")
  
  parentId              String?       @map("parent_id")
  parent                OrphaMedicalClassification? @relation("SpecialtyHierarchy", fields: [parentId], references: [id])
  children              OrphaMedicalClassification[] @relation("SpecialtyHierarchy")
  
  @@map("orpha_medical_classifications")
}

// =====================================================================================
// 5. FENÓTIPOS (HPO)
// =====================================================================================

model OrphaPhenotype {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  hpoId                 String        @map("hpo_id")                 
  hpoTerm               String        @map("hpo_term")
  
  frequencyHpoId        String?       @map("frequency_hpo_id")       
  frequencyTerm         String?       @map("frequency_term")         
  frequencyValue        String?       @map("frequency_value")        
  
  diagnosticCriteria    String?       @map("diagnostic_criteria")    
  
  @@map("orpha_phenotypes")
}

// =====================================================================================
// 6. SINAIS CLÍNICOS ✅ JÁ TEM CAMPOS PT
// =====================================================================================

model OrphaClinicalSign {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  signName              String        @map("sign_name")
  signNamePt            String?       @map("sign_name_pt")            // ✅ JÁ TEM
  
  frequency             String?       
  frequencyValue        String?       @map("frequency_value")
  signCategory          String?       @map("sign_category")
  
  @@map("orpha_clinical_signs")
}

// =====================================================================================
// 7. ASSOCIAÇÕES GENÉTICAS (PRECISA CAMPOS PT)
// =====================================================================================

model OrphaGeneAssociation {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  geneSymbol            String        @map("gene_symbol")            
  geneName              String?       @map("gene_name")
  geneNamePt            String?       @map("gene_name_pt")           // ❌ NOVO - PRECISA
  
  hgncId                String?       @map("hgnc_id")
  entrezGeneId          String?       @map("entrez_gene_id")
  ensemblGeneId         String?       @map("ensembl_gene_id")
  omimGeneId            String?       @map("omim_gene_id")
  
  associationType       String        @map("association_type")       
  associationTypePt     String?       @map("association_type_pt")    // ❌ NOVO - PRECISA
  associationStatus     String?       @map("association_status")
  
  inheritancePattern    String?       @map("inheritance_pattern")
  inheritancePatternPt  String?       @map("inheritance_pattern_pt") // ❌ NOVO - PRECISA
  
  @@map("orpha_gene_associations")
}

// =====================================================================================
// 8. HISTÓRIA NATURAL (PRECISA CAMPOS PT)
// =====================================================================================

model OrphaNaturalHistory {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  ageOfOnset            String?       @map("age_of_onset")
  ageOfOnsetPt          String?       @map("age_of_onset_pt")        // ❌ NOVO - PRECISA
  ageOfOnsetHpoId       String?       @map("age_of_onset_hpo_id")
  
  ageOfDeath            String?       @map("age_of_death")
  ageOfDeathPt          String?       @map("age_of_death_pt")        // ❌ NOVO - PRECISA
  ageOfDeathHpoId       String?       @map("age_of_death_hpo_id")
  
  lifeExpectancy        String?       @map("life_expectancy")
  lifeExpectancyPt      String?       @map("life_expectancy_pt")     // ❌ NOVO - PRECISA
  
  prognosis             String?
  prognosisPt           String?       @map("prognosis_pt")           // ❌ NOVO - PRECISA
  
  severity              String?
  severityPt            String?       @map("severity_pt")            // ❌ NOVO - PRECISA
  
  courseOfDisease       String?       @map("course_of_disease")
  courseOfDiseasePt     String?       @map("course_of_disease_pt")   // ❌ NOVO - PRECISA
  
  @@map("orpha_natural_history")
}

// =====================================================================================
// 9. DADOS EPIDEMIOLÓGICOS (PRECISA CAMPOS PT)
// =====================================================================================

model OrphaEpidemiology {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  prevalenceClass       String?       @map("prevalence_class")       
  prevalenceClassPt     String?       @map("prevalence_class_pt")    // ❌ NOVO - PRECISA
  prevalenceValue       String?       @map("prevalence_value")
  prevalenceType        String?       @map("prevalence_type")        
  prevalenceTypePt      String?       @map("prevalence_type_pt")     // ❌ NOVO - PRECISA
  
  populationType        String?       @map("population_type")        
  populationTypePt      String?       @map("population_type_pt")     // ❌ NOVO - PRECISA
  populationDescription String?       @map("population_description")
  populationDescriptionPt String?     @map("population_description_pt") // ❌ NOVO - PRECISA
  
  geographicArea        String?       @map("geographic_area")
  geographicAreaPt      String?       @map("geographic_area_pt")     // ❌ NOVO - PRECISA
  
  dataSource            String?       @map("data_source")
  validationStatus      String?       @map("validation_status")
  
  @@map("orpha_epidemiology")
}

// =====================================================================================
// 10. INFORMAÇÕES TEXTUAIS ✅ JÁ TEM CAMPOS PT
// =====================================================================================

model OrphaTextualInformation {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  
  textSection           String        @map("text_section")           
  textSectionCode       String?       @map("text_section_code")
  
  textEn                String?       @map("text_en")
  textPt                String?       @map("text_pt")                // ✅ JÁ TEM
  
  lastUpdate            String?       @map("last_update")
  validationStatus      String?       @map("validation_status")
  
  @@map("orpha_textual_information")
}

// =====================================================================================
// 11. HPO TERMS (PRECISA CAMPOS PT)
// =====================================================================================

model HPOTerm {
  id                    String @id @default(cuid())
  
  hpoId                 String @unique      
  hpoCode               String           
  
  name                  String              
  namePt                String?    @map("name_pt")                  // ❌ NOVO - PRECISA
  definition            String?       
  definitionPt          String?    @map("definition_pt")            // ❌ NOVO - PRECISA
  comment               String?          
  commentPt             String?    @map("comment_pt")               // ❌ NOVO - PRECISA
  
  parentTerms           String?      
  childTerms            String?       
  
  exactSynonyms         String?    
  exactSynonymsPt       String?    @map("exact_synonyms_pt")        // ❌ NOVO - PRECISA
  broadSynonyms         String?    
  narrowSynonyms        String?   
  relatedSynonyms       String?  
  
  isObsolete            Boolean @default(false)
  replacedBy            String?       
  
  xrefs                 String?           
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  phenotypeAssociations HPOPhenotypeAssociation[]
  geneAssociations      HPOGeneAssociation[]
  diseaseAssociations   HPODiseaseAssociation[]
  
  @@map("hpo_terms")
}

// =====================================================================================
// 12. DRUGBANK - MEDICAMENTOS (NOVOS MODELOS)
// =====================================================================================

model DrugBankDrug {
  id                    String    @id @default(uuid())
  drugbank_id           String    @unique @map("drugbank_id")       
  
  // Nomes multilíngues
  name                  String                                      
  namePt                String?   @map("name_pt")                   // ❌ NOVO - PRECISA
  generic_name          String?   @map("generic_name")             
  generic_namePt        String?   @map("generic_name_pt")           // ❌ NOVO - PRECISA
  brand_names           String?   // JSON array
  brand_namesPt         String?   @map("brand_names_pt")            // ❌ NOVO - PRECISA
  
  // Classificação
  drug_type             String?   @map("drug_type")                
  drug_typePt           String?   @map("drug_type_pt")              // ❌ NOVO - PRECISA
  indication            String?                                    
  indicationPt          String?   @map("indication_pt")             // ❌ NOVO - PRECISA
  mechanism_action      String?   @map("mechanism_action")         
  mechanism_actionPt    String?   @map("mechanism_action_pt")       // ❌ NOVO - PRECISA
  
  // Status regulatório
  approval_status       String?   @map("approval_status")          
  approval_statusPt     String?   @map("approval_status_pt")        // ❌ NOVO - PRECISA
  orphan_status         Boolean   @default(false) @map("orphan_status") 
  
  // Propriedades químicas
  molecular_formula     String?   @map("molecular_formula")
  molecular_weight      Float?    @map("molecular_weight")
  smiles                String?                                    
  inchi                 String?                                    
  
  // Farmacocinética
  absorption            String?                                    
  absorptionPt          String?   @map("absorption_pt")             // ❌ NOVO - PRECISA
  metabolism            String?                                    
  metabolismPt          String?   @map("metabolism_pt")             // ❌ NOVO - PRECISA
  excretion             String?                                    
  excretionPt           String?   @map("excretion_pt")              // ❌ NOVO - PRECISA
  half_life             String?   @map("half_life")                
  
  // Categorias terapêuticas
  atc_codes             String?   @map("atc_codes")                
  therapeutic_class     String?   @map("therapeutic_class")
  therapeutic_classPt   String?   @map("therapeutic_class_pt")     // ❌ NOVO - PRECISA
  pharmacological_class String?   @map("pharmacological_class")
  pharmacological_classPt String? @map("pharmacological_class_pt") // ❌ NOVO - PRECISA
  
  // Descrições
  description           String?                                    
  descriptionPt         String?   @map("description_pt")            // ❌ NOVO - PRECISA
  toxicity              String?                                    
  toxicityPt            String?   @map("toxicity_pt")               // ❌ NOVO - PRECISA
  pharmacodynamics      String?                                    
  pharmacodynamicsPt    String?   @map("pharmacodynamics_pt")       // ❌ NOVO - PRECISA
  
  // Open Data IDs
  uriRdf                String?   @map("uri_rdf")                   
  jsonldId              String?   @map("jsonld_id")                 
  csvId                 String?   @map("csv_id")                    
  
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  
  interactions         DrugInteraction[] @relation("DrugInteractions")
  diseaseAssociations  DrugDiseaseAssociation[]
  
  @@map("drugbank_drugs")
}

// =====================================================================================
// 13. INTERAÇÕES MEDICAMENTOSAS (PRECISA CAMPOS PT)
// =====================================================================================

model DrugInteraction {
  id                   String    @id @default(uuid())
  
  drug1_id             String    @map("drug1_id")
  drug2_id             String    @map("drug2_id")
  drug1                DrugBankDrug @relation("DrugInteractions", fields: [drug1_id], references: [id])
  
  interaction_type     String?   @map("interaction_type")          
  interaction_typePt   String?   @map("interaction_type_pt")       // ❌ NOVO - PRECISA
  severity             String?                                     
  severityPt           String?   @map("severity_pt")               // ❌ NOVO - PRECISA
  description          String?                                     
  descriptionPt        String?   @map("description_pt")            // ❌ NOVO - PRECISA
  mechanism            String?                                     
  mechanismPt          String?   @map("mechanism_pt")              // ❌ NOVO - PRECISA
  clinical_effect      String?   @map("clinical_effect")           
  clinical_effectPt    String?   @map("clinical_effect_pt")        // ❌ NOVO - PRECISA
  management           String?                                     
  managementPt         String?   @map("management_pt")             // ❌ NOVO - PRECISA
  
  evidence_level       String?   @map("evidence_level")            
  references           String?                                     
  
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  
  @@unique([drug1_id, drug2_id])
  @@map("drug_interactions")
}

// =====================================================================================
// 14. ASSOCIAÇÕES MEDICAMENTO-DOENÇA (PRECISA CAMPOS PT)
// =====================================================================================

model DrugDiseaseAssociation {
  id                   String    @id @default(uuid())
  
  drug_id              String    @map("drug_id")
  disease_id           String    @map("disease_id")
  drug                 DrugBankDrug @relation(fields: [drug_id], references: [id])
  disease              OrphaDisease @relation(fields: [disease_id], references: [id])
  
  association_type     String    @map("association_type")          
  association_typePt   String?   @map("association_type_pt")       // ❌ NOVO - PRECISA
  indication_type      String?   @map("indication_type")           
  indication_typePt    String?   @map("indication_type_pt")        // ❌ NOVO - PRECISA
  
  efficacy            String?                                      
  efficacyPt          String?   @map("efficacy_pt")               // ❌ NOVO - PRECISA
  dosage              String?                                      
  dosagePt            String?   @map("dosage_pt")                 // ❌ NOVO - PRECISA
  administration      String?                                      
  administrationPt    String?   @map("administration_pt")         // ❌ NOVO - PRECISA
  
  evidence_level      String?   @map("evidence_level")             
  clinical_trials     String?   @map("clinical_trials")           
  
  approval_status     String?   @map("approval_status")           
  orphan_indication   Boolean   @default(false) @map("orphan_indication") 
  
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")
  
  @@unique([drug_id, disease_id])
  @@map("drug_disease_associations")
}

// =====================================================================================
// MODELOS EXISTENTES (sem mudança)
// =====================================================================================

model CPLPCountry {
  id                    Int           @id @default(autoincrement())
  code                  String        @unique
  name                  String
  namePt                String        @map("name_pt")
  flagEmoji             String?       @map("flag_emoji")
  population            BigInt?
  language              String        @default("pt")
  
  healthcareSystem      String?       @map("healthcare_system")
  rareDiseasePolicy     String?       @map("rare_disease_policy")
  orphanDrugPolicy      String?       @map("orphan_drug_policy")
  
  epidemiologyData      OrphaCPLPEpidemiology[]
  
  createdAt             DateTime      @default(now()) @map("created_at")
  
  @@map("cplp_countries")
}

model OrphaCPLPEpidemiology {
  id                    String        @id @default(uuid())
  orphaDiseaseId        String        @map("orpha_disease_id")
  disease               OrphaDisease  @relation(fields: [orphaDiseaseId], references: [id], onDelete: Cascade)
  countryId             Int           @map("country_id")
  country               CPLPCountry   @relation(fields: [countryId], references: [id])
  
  estimatedCases        Int?          @map("estimated_cases")
  prevalencePer100k     Float?        @map("prevalence_per_100k")
  incidencePer100k      Float?        @map("incidence_per_100k")
  
  dataSource            String?       @map("data_source")
  dataQuality           String?       @map("data_quality")
  collectionYear        Int?          @map("collection_year")
  
  notes                 String?
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  
  @@map("orpha_cplp_epidemiology")
}

model OrphaImportLog {
  id                    String        @id @default(uuid())
  
  importType            String        @map("import_type")            
  sourceUrl             String?       @map("source_url")
  sourceFile            String?       @map("source_file")
  
  status                String        
  recordsProcessed      Int?          @map("records_processed")
  recordsSucceeded      Int?          @map("records_succeeded")
  recordsFailed         Int?          @map("records_failed")
  
  errorMessages         String?       @map("error_messages")         
  importSummary         String?       @map("import_summary")         
  
  startedAt             DateTime?     @map("started_at")
  completedAt           DateTime?     @map("completed_at")
  createdAt             DateTime      @default(now()) @map("created_at")
  
  @@map("orpha_import_logs")
}

model HPOPhenotypeAssociation {
  id String @id @default(cuid())
  
  orphaDiseaseId String
  orphaDisease OrphaDisease @relation(fields: [orphaDiseaseId], references: [id])
  
  hpoTermId String
  hpoTerm HPOTerm @relation(fields: [hpoTermId], references: [id])
  
  frequencyHPO String?     
  frequencyTerm String?    
  frequencyNumeric Float?  
  
  onsetHPO String?         
  onsetTerm String?        
  
  severity String?         
  clinicalModifiers String? 
  
  evidence String?         
  reference String?        
  
  frequency String?        
  qualifier String?        
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([orphaDiseaseId, hpoTermId])
  @@map("hpo_phenotype_associations")
}

model HPOGeneAssociation {
  id String @id @default(cuid())
  
  geneSymbol String        
  geneId String?           
  ensemblId String?        
  
  hpoTermId String
  hpoTerm HPOTerm @relation(fields: [hpoTermId], references: [id])
  
  associationType String?  
  evidence String?         
  reference String?        
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([geneSymbol, hpoTermId])
  @@map("hpo_gene_associations")
}

model HPODiseaseAssociation {
  id String @id @default(cuid())
  
  diseaseId String         
  diseaseName String       
  
  hpoTermId String
  hpoTerm HPOTerm @relation(fields: [hpoTermId], references: [id])
  
  qualifier String?        
  frequencyTerm String?    
  frequencyHPO String?     
  onsetTerm String?        
  onsetHPO String?         
  
  evidence String          
  reference String?        
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([diseaseId, hpoTermId])
  @@map("hpo_disease_associations")
}
